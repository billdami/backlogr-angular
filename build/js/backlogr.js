angular.module("backlogr",["ngSanitize","ngAnimate","ui.router","ui.bootstrap.dropdown","cfp.hotkeys","comboBox","toastNotifications"]).config(["hotkeysProvider",function(o){o.includeCheatSheet=!1}]).run(["$window","$document",function(o,t){o.FastClick.attach(t[0].body)}]);
angular.module("backlogr").config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("games",{"abstract":!0,url:"/games/:cat",templateUrl:"routes/games.html"}).state("games.list",{url:"",templateUrl:"routes/games-list.html",controller:"GamesListController as gamesListCtrl"}).state("games.detail",{url:"/game/:id",templateUrl:"routes/game-detail.html",controller:"GameDetailController as gameCtrl"}).state("about",{url:"/about",templateUrl:"routes/about.html"}).state("404",{url:"/not-found",templateUrl:"routes/not-found.html"}),e.otherwise("/games/library")}]);
angular.module("backlogr").controller("AddGameFormController",["Games","Platforms","Window","$filter","$rootScope","$scope",function(e,t,a,o,r,n){var l=this;l.dropdownIsOpen=!1,l.focusPlatformSelect=!1,l.completed=!1,l.wishlisted=!1,l.gbGames=[],l.searchDebounceDelay=250,l.searchIsLoading=!1,l.gameInputValue="",l.game=null,l.platform="",l.platforms=[],l.filteredPlatforms=[],l.filteredPlatformGroups=[],l.platformsLoading=!0,r.$on("$stateChangeSuccess",function(t,a,o){o.cat&&e.categories[o.cat]&&e.categories[o.cat].filters&&(l.completed=e.categories[o.cat].filters.completed===!0,l.wishlisted=e.categories[o.cat].filters.wishlisted===!0)}),n.$on("openAddGameForm",function(){l.dropdownIsOpen=!0}),n.$watch(function(){return l.dropdownIsOpen},function(e){e===!0&&a.isLargeDevice()&&(l.focusPlatformSelect=!0)}),t.all().then(function(e){l.platformsLoading=!1,l.platforms=e,l.updateFilteredPlatforms()}),l.updateFilteredPlatforms=function(){return l.game&&l.game.platforms?(l.filteredPlatforms=o("filter")(l.platforms,function(e){return-1!==l.game.platforms.indexOf(e._id)}),l.filteredPlatformGroups=o("filter")(t.groups,function(e){return null!==o("findByProperty")(l.filteredPlatforms,"group",e.id)}),void(1===l.filteredPlatforms.length&&(l.platform=String(l.filteredPlatforms[0]._id)))):(l.filteredPlatformGroups=t.groups,void(l.filteredPlatforms=l.platforms))},l.searchGames=function(e){var t=e.term.trim();return l.gameInputValue=t,t.length<1?void(l.gbGames=[]):(l.searchIsLoading=!0,void l.querySearchApi(t))},l.querySearchApi=_.debounce(function(t){e.searchGiantBombGames(t,l.platform,20,0).then(function(e){l.searchIsLoading=!1,l.gbGames=e})},l.searchDebounceDelay),l.onPlatformChange=function(){l.gameInputValue.length>0&&l.searchGames({term:l.gameInputValue})},l.onSelectGame=function(e){l.game=e.item,l.updateFilteredPlatforms()},l.onClearGameSelection=function(){l.game=null,l.updateFilteredPlatforms()},l.addGame=function(t,a){e.create(t,!0).then(function(){l.clearForm(),a&&l.closeDropDown()})},l.formIsValid=function(){return!l.form.$invalid&&l.game},l.clearForm=function(){l.game=null,l.gbGames=[]},l.closeDropDown=function(){l.dropdownIsOpen=!1},l.onSubmit=function(){var e=t.get(l.platform);l.addGame({platformId:e._id,platformName:e.name,gbGameId:l.game._id,gameName:l.game.name,hasImg:l.game.storedThumbImg,releaseDate:new Date(l.game.normalizedReleaseDate),completed:l.completed,wishlisted:l.wishlisted,starred:!1},!0)}}]);
angular.module("backlogr").controller("AppController",["$timeout","Window","Modal","LocalStorage",function(e,n,o,t){var l=this,a=300;l.leftNavIsOpen=!0,e(function(){l.isLoaded=!0},1),t.get("welcomeShown")||e(function(){o.show({templateUrl:"modals/welcome.html",controllerAs:"welcomeCtrl",controller:function(e,n){e.closeModal=function(){t.set("welcomeShown",!0),n()}}})},100),l.toggleLeftNav=function(){return l[l.leftNavIsOpen?"closeLeftNav":"openLeftNav"]()},l.closeLeftNav=function(){return l.leftNavIsOpen=!1,e(function(){return l.leftNavIsOpen},n.isSmallDevice()?a:0)},l.openLeftNav=function(){return l.leftNavIsOpen=!0,e(function(){return l.leftNavIsOpen},n.isSmallDevice()?a:0)}}]);
angular.module("backlogr").controller("GameDetailController",["Games","$state","$stateParams","$window",function(e,a,t,o){var m=this;return m.gamesService=e,m.game=e.getById(t.id),m.gbGame={},m.game?(m.amazonUrl="http://www.amazon.com/gp/search?ie=UTF8&camp=1789&creative=9325&index=videogames&keywords="+o.encodeURIComponent(m.game.gameName+" "+m.game.platformName)+"&linkCode=ur2&tag=libjitsu-20",m.metacriticUrl="http://www.metacritic.com/search/game/"+o.encodeURIComponent(m.game.gameName)+"/results",m.gamefaqsUrl="http://www.gamefaqs.com/search?game="+o.encodeURIComponent(m.game.gameName),e.getGiantBombGame(m.game.gbGameId).then(function(e){m.gbGame=e}),m.markCompleted=function(){e.update(m.game,{completed:!0,wishlisted:!1},!0)},m.moveToLibrary=function(){e.update(m.game,{wishlisted:!1},!0)},m.moveToBacklog=function(){e.update(m.game,{completed:!1,wishlisted:!1},!0)},m.moveToWishlist=function(){e.update(m.game,{wishlisted:!0},!0)},m.star=function(){e.update(m.game,{starred:!0},!0)},m.unstar=function(){e.update(m.game,{starred:!1},!0)},m.onStarToggle=function(a){e.update(m.game,{starred:a.active},!1)},m.onNotesUpdate=function(a){e.update(m.game,{notes:a.content},!1)},m.remove=function(){e.remove(m.game,!0),m.backToList()},void(m.backToList=function(){a.go("games.list",{cat:t.cat})})):a.go("404",{},{location:!1})}]);
angular.module("backlogr").controller("GamesListController",["Games","$stateParams","$state","$scope","$rootScope","$filter","hotkeys","Modal",function(e,t,a,o,s,n,l,c){var i=this;return e.categories[t.cat]?(i.getFilteredGames=function(){var t=e.games;return t=n("filter")(t,i.gamesFilter),t=n("orderBy")(t,e.orderBy)},i.category=t.cat,i.gamesService=e,i.gamesFilter=e.categories[t.cat].filters,i.games=i.getFilteredGames(),i.numSelected=e.getSelection(i.gamesFilter).length,i.hasSelection=i.numSelected>0,i.lastFocusedGame=null,i.initScrollPos=e.categories[t.cat].scrollPos,o.$watch(function(){return e.games},function(){i.games=i.getFilteredGames()},!0),o.$watch(function(){return e.getOrderBy()},function(){i.games=i.getFilteredGames()}),o.$watch(function(){return e.getSelection(i.gamesFilter).length},function(e){i.numSelected=e}),o.$watch(function(){return e.hasSelection(i.gamesFilter)},function(e){i.hasSelection=e}),i.openAddGameForm=function(e){e.stopPropagation(),s.$broadcast("openAddGameForm")},i.openDetail=function(e){a.go("games.detail",{cat:t.cat,id:e.id})},i.markSelectionCompleted=function(){e.updateSelection({completed:!0,wishlisted:!1},i.gamesFilter,!0)},i.moveSelectionToLibrary=function(){e.updateSelection({wishlisted:!1},i.gamesFilter,!0)},i.moveSelectionToBacklog=function(){e.updateSelection({completed:!1,wishlisted:!1},i.gamesFilter,!0)},i.moveSelectionToWishlist=function(){e.updateSelection({wishlisted:!0},i.gamesFilter,!0)},i.starSelection=function(){e.updateSelection({starred:!0},i.gamesFilter,!0)},i.unstarSelection=function(){e.updateSelection({starred:!1},i.gamesFilter,!0)},i.removeSelection=function(){c.showConfirm({confirmTitle:"Delete games",bodyText:"Are you sure you want to delete the selected games?",confirmBtnText:"Delete",cancelBtnText:"Cancel",onConfirm:angular.bind(i,function(){e.removeSelection(i.gamesFilter,!0)})})},i.onStarToggle=function(t){e.update(t.game,{starred:t.active},!1)},i.updateSortProp=function(t){e.updateSortProp(t)},i.toggleSortDir=function(){e.toggleSortDir()},i.toggleSelection=function(){0===i.numSelected?e.selectGames(i.games):e.deselectGames(i.games)},i.onGameClick=function(t,a){var o=i.games.indexOf(t),s=i.lastFocusedGame?i.games.indexOf(i.lastFocusedGame):-1,n=[],l=Math.min(o,s),c=Math.max(o,s);if(i.lastFocusedGame=t,a.ctrlKey||a.metaKey?e.toggleGameSelection(t):e.selectGame(t),a.shiftKey&&-1!==s&&o!==s){for(;c>=l;)n.push(i.games[l]),l++;e.selectGames(n)}},i.onGameSelClick=function(t,a){var o=i.games.indexOf(t),s=i.lastFocusedGame?i.games.indexOf(i.lastFocusedGame):-1,n=[],l=Math.min(o,s),c=Math.max(o,s);if(e.toggleGameSelection(t),i.lastFocusedGame=t,a.shiftKey&&-1!==s&&o!==s){for(;c>=l;)n.push(i.games[l]),l++;e.selectGames(n)}},i.onArrowDown=function(t){var a=i.lastFocusedGame?i.games.indexOf(i.lastFocusedGame):-1,o=a===i.games.length-1?0:a+1,s=i.games[o];c.isOpen()||s&&(t.preventDefault(),t.shiftKey?(s.selected&&e.deselectGame(i.lastFocusedGame),e.selectGame(s,!0)):e.selectGame(s,!1),s.lastFocused=!0,i.lastFocusedGame=s)},i.onArrowUp=function(t){var a=i.lastFocusedGame?i.games.indexOf(i.lastFocusedGame):0,o=0===a?i.games.length-1:a-1,s=i.games[o];c.isOpen()||s&&(t.preventDefault(),t.shiftKey?(s.selected&&e.deselectGame(i.lastFocusedGame),e.selectGame(s,!0)):e.selectGame(s,!1),s.lastFocused=!0,i.lastFocusedGame=s)},i.onListScroll=function(a){e.categories[t.cat].scrollPos=a.scrollTop},void l.bindTo(o).add({combo:["down","shift+down"],description:"select next game",callback:angular.bind(i,i.onArrowDown)}).add({combo:["up","shift+up"],description:"select previous game",callback:angular.bind(i,i.onArrowUp)})):a.go("games.list",{cat:"library"},{location:"replace"})}]);
angular.module("backlogr").controller("SidebarController",["$state","$scope","Games",function(t,o,n){var e=this;e.categoryCounts=n.getCategoryCounts(),o.$watch(function(){return n.getCategoryCounts()},function(t,o){t!==o&&(e.categoryCounts=t)},!0),e.closeNavAndGo=function(n,e){o.appCtrl.closeLeftNav(!0).then(function(){t.go(n,e)})},e.categoryCls=function(o){return{active:t.includes("games",{cat:o})}}}]);
angular.module("backlogr").filter("findByProperty",function(){return function(r,n,e){var t,f;for(t=0;t<r.length;t++)if("object"==typeof n){if(f=!0,angular.forEach(n,function(n,e){r[t][e]!==n&&(f=!1)}),f)return r[t]}else if(r[t][n]===e)return r[t];return null}});
angular.module("backlogr").filter("nl2br",function(){return function(r){return r?(r+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2"):""}});
angular.module("comboBox",[]).controller("comboBoxController",["$scope",function(e){var t=this,o={13:"selectFocusedItem",27:"clear",38:"selectPreviousItem",40:"selectNextItem"};t.inputValue="",t.isOpen=!1,t.selectedItem=null,t.focusedItem=null,t.emptyText=t.emptyText||"No results found",t.loadingText="Loading, please wait...",t.init=function(){e.$watch(t.getModel,function(e){t.internalModelChange||(e?t.selectItem(e):t.clearSelection(!0)),t.internalModelChange=!1}),e.$watch(t.getItems,function(e){e&&e.length>0&&t.autoSelectExactMatch()})},t.getModel=function(){return t.model},t.getItems=function(){return t.items},t.autoSelectExactMatch=function(){var e;if(t.inputValue&&t.inputValue.length>0&&t.items&&t.items.length>0)for(e=0;e<t.items.length;e++)if(t.inputValue.toUpperCase()===t.items[e][t.modelLabel].toUpperCase()){t.selectItem(t.items[e],!1);break}},t.selectItem=function(e,o){t.internalModelChange=!0,t.selectedItem=e,t.model=e,t.focusedItem=null,t.inputValue=e[t.modelLabel],t.onInput&&t.onInput({term:t.inputValue}),t.onSelect&&t.onSelect({item:e}),o&&t.closeMenu()},t.clearSelection=function(e){t.internalModelChange=!0,t.selectedItem=null,t.model=null,e&&(t.inputValue=""),t.onClearSelection&&t.onClearSelection()},t.clear=function(e){!t.inputValue||t.inputValue.length<1||(t.clearSelection(!0),t.closeMenu(),e&&e.stopPropagation())},t.selectFocusedItem=function(e){t.focusedItem&&(t.selectItem(t.focusedItem,!0),e&&e.preventDefault())},t.selectPreviousItem=function(e){var o=-1;t.isOpen&&(t.items&&t.items.length>0&&(t.focusedItem&&(o=t.items.indexOf(t.focusedItem)-1),0>o&&(o=t.items.length-1),t.focusedItem=t.items[o],t.items[o].lastFocused=!0),e&&e.preventDefault())},t.selectNextItem=function(e){var o=-1;t.isOpen&&(t.items&&t.items.length>0&&(t.focusedItem&&(o=t.items.indexOf(t.focusedItem)),o++,o>=t.items.length&&(o=0),t.focusedItem=t.items[o],t.items[o].lastFocused=!0),e&&e.preventDefault())},t.openMenu=function(){t.isOpen=!0},t.closeMenu=function(){t.isOpen=!1},t.registerInput=function(e){t.cbInput=e},t.registerMenu=function(e){t.cbMenu=e},t.onInputChange=function(){t.clearSelection(),t.inputValue.trim().length<1?t.closeMenu():t.openMenu(),t.onInput&&t.onInput({term:t.inputValue})},t.onInputKeyDown=function(e){o[e.keyCode]&&t[o[e.keyCode]](e)},t.onItemClick=function(e){t.selectItem(e,!0)}}]).directive("comboBox",[function(){return{restrict:"E",scope:{model:"=",items:"=",modelLabel:"@",modelImgUrl:"@",showImages:"@",itemTemplateUrl:"@",required:"@",placeholder:"@",emptyText:"@",isLoading:"=",onInput:"&",onSelect:"&",onClearSelection:"&"},templateUrl:"directives/combo-box/combo-box.html",bindToController:!0,controllerAs:"cb",controller:"comboBoxController",link:function(e,t,o,n){n.init()}}}]).directive("comboBoxMenu",[function(){return{restrict:"E",transclude:!0,require:"^comboBox",scope:{},templateUrl:"directives/combo-box/combo-box-menu.html",link:function(e,t,o,n){e.cbCtrl=n,n.registerMenu(e)}}}]).directive("comboBoxItem",[function(){return{restrict:"A",require:"^comboBox",scope:{model:"="},templateUrl:"directives/combo-box/combo-box-item.html",link:function(e,t,o,n){e.cb=n,e.label=e.model[n.modelLabel],e.showImg=n.showImages,n.modelImgUrl&&(t.addClass("combo-box-item-has-img"),e.imgUrl=e.model[n.modelImgUrl])}}}]).directive("comboBoxInput",[function(){return{restrict:"A",require:"^comboBox",scope:{},link:function(e,t,o,n){n.registerInput(e)}}}]);
angular.module("backlogr").directive("focusWhen",["$timeout",function(t){return{restrict:"A",scope:{trigger:"=focusWhen"},link:function(n,r){n.$watch("trigger",function(c){c===!0&&t(function(){r[0].focus(),n.trigger=!1})})}}}]);
angular.module("backlogr").directive("modalDialog",[function(){return{restrict:"E",scope:{modalTitle:"@",modalSize:"@",backdrop:"<",backdropClickClose:"<",escClose:"<",closeable:"<",close:"&"},templateUrl:"directives/modal-dialog.html",replace:!0,transclude:!0,bindToController:!0,controllerAs:"modalCtrl",controller:function(){var l=this;l.showBackdrop=l.backdrop!==!1,l.allowClose=l.closeable!==!1,l.closeOnClick=l.backdropClickClose!==!1,l.closeOnEsc=l.escClose!==!1,l.closeModal=function(){l.allowClose&&l.close&&l.close()},l.onBackdropClick=function(o){l.closeOnClick&&angular.element(o.target).hasClass("modal")&&l.closeModal()},l.onBackdropKeydown=function(o){27===o.keyCode&&l.closeOnEsc&&l.closeModal()}},link:function(l,o,e,c){l.modalCtrl=c}}}]);
angular.module("backlogr").directive("scrollIntoView",[function(){return{restrict:"A",scope:{scrollIntoView:"=",offsetDepth:"="},link:function(o,t){var e=t[0],f=e.offsetParent,s=1;if(o.offsetDepth&&o.offsetDepth>1)for(;s<o.offsetDepth&&f;)e=f,f=f.offsetParent,s++;o.$watch("scrollIntoView",function(t){var s=e.offsetHeight,l=e.offsetTop+s,r=f&&f.offsetHeight?f.offsetHeight:0;t===!0&&r&&(o.scrollIntoView=!1,e.offsetTop<f.scrollTop?f.scrollTop=e.offsetTop:l>r+f.scrollTop&&(f.scrollTop=l-r))})}}}]);
angular.module("backlogr").directive("starButton",[function(){return{restrict:"E",scope:{active:"<",onChange:"&",dontPropagateClick:"@"},templateUrl:"directives/star-button.html",link:function(t){t.active=!!t.active,t.onClick=function(a){t.dontPropagateClick&&a.stopPropagation(),t.active=!t.active,t.onChange&&t.onChange({active:t.active})}}}}]);
angular.module("backlogr").directive("stopPropagation",[function(){return{restrict:"A",link:function(o,n){n.on("click",function(o){o.stopPropagation()}),n.on("$destroy",function(){n.off("click")})}}}]);
angular.module("backlogr").directive("textContentEditor",["$document",function(n){return{restrict:"E",scope:{content:"<",onChange:"&",placeholder:"@"},templateUrl:"directives/text-content-editor.html",link:function(t,o){var e=function(c){c&&o&&o[0].contains(c.target)||(n.off("click",e),t.$apply(function(){t.isEditing=!1}))};t.content=t.content?t.content.trim():"",t.isEditing=!1,t.focusTextarea=!1,t.onContentClick=function(){t.isEditing=!0,t.focusTextarea=!0,n.on("click",e)},t.onContentChange=function(){t.onChange&&t.onChange({content:t.content.trim()})},t.$on("$destroy",function(){n.off("click",e)})}}}]);
angular.module("toastNotifications",[]).factory("ToastsService",["$timeout",function(t){return{_items:[],_defaultConfig:{text:"",context:"default",icon:null,autoClose:!0,closeOnClick:!0,closeDelay:3500},_defaultIcons:{"default":"check-circle",success:"check-circle",danger:"exclamation-circle",warning:"exclamation-triangle",info:"info-circle"},add:function(t){var e=this,o=angular.extend({},e._defaultConfig,t);null===o.icon&&(o.icon=e._defaultIcons[o.context]),e._items.push(o),e.startCloseTimer(o)},remove:function(t){var e=this,o=e._items.indexOf(t);o>-1&&(e.clearCloseTimer(t),e._items.splice(o,1))},removeAll:function(){var t=this;angular.forEach(t._items,function(e){t.clearCloseTimer(e)}),t._items=[]},startCloseTimer:function(e){var o=this;return e.autoClose&&e.closeDelay>0&&(o.clearCloseTimer(e),e.closeTimer=t(angular.bind(o,o.remove,e),e.closeDelay)),e},clearCloseTimer:function(e){return e.closeTimer&&t.cancel(e.closeTimer),e}}}]).controller("ToastsController",["ToastsService",function(t){var e=this;e.items=t._items,e.removeItem=function(e){t.remove(e)},e.cancelAutoClose=function(e){t.clearCloseTimer(e)},e.restartAutoClose=function(e){t.startCloseTimer(e)}}]).directive("toastNotifications",[function(){return{restrict:"E",scope:{},templateUrl:"directives/toast-notifications/toast-notifications.html",bindToController:!0,controllerAs:"toastsCtrl",controller:"ToastsController"}}]).directive("toastItem",[function(){return{restrict:"A",require:"^toastNotifications",scope:{toastItem:"="},templateUrl:"directives/toast-notifications/toast-item.html",link:function(t,e,o,s){t.hasIcon="string"==typeof t.toastItem.icon,t.toastClasses={"close-on-click":t.toastItem.closeOnClick,"has-media":t.hasIcon},t.iconClasses={},t.hasIcon&&(t.iconClasses["fa-"+t.toastItem.icon]=!0),t.toastClasses[t.toastItem.context]=!0,t.onClick=function(){t.toastItem.closeOnClick&&s.removeItem(t.toastItem)},t.onMouseEnter=function(){s.cancelAutoClose(t.toastItem)},t.onMouseLeave=function(){s.restartAutoClose(t.toastItem)}}}}]);
angular.module("backlogr").directive("trackScroll",["$timeout",function(o){return{restrict:"A",scope:{initScrollTop:"<",debounceDelay:"@",onScroll:"&"},link:function(l,c){var n,r=parseInt(l.debounceDelay,10);r&&!isNaN(r)||(r=250),l.initScrollTop&&!isNaN(l.initScrollTop)&&o(function(){c[0].scrollTop=l.initScrollTop},1),n=_.debounce(function(){l.onScroll&&l.onScroll({scrollTop:c[0].scrollTop})},r),c.on("scroll",n),c.on("$destroy",function(){c.off("scroll")})}}}]);
angular.module("backlogr").factory("Games",["$http","$filter","$q","LocalStorage","ToastsService",function(e,t,a,r,s){var i="http://libjitsu.herokuapp.com/api/giantbomb-games",o="https://d13cj59cnxon24.cloudfront.net/games/thumb/",n={games:[],gbGamesCache:{},orderBy:null,orderByProp:null,orderDesc:!1,categories:{library:{scrollPos:0,filters:{wishlisted:!1}},backlog:{scrollPos:0,filters:{completed:!1,wishlisted:!1}},completed:{scrollPos:0,filters:{completed:!0,wishlisted:!1}},wishlist:{scrollPos:0,filters:{wishlisted:!0}},starred:{scrollPos:0,filters:{starred:!0}}},init:function(){return this.games=this._fetchGamesFromStorage(),this.orderByProp=r.get("gamesOrderByProp")||" gameName",this.orderDesc=r.get("gamesOrderDesc")||!1,this.updateSorting(),this},getCategoryCounts:function(){var e={};return angular.forEach(this.categories,function(a,r){e[r]=t("filter")(this.games,a.filters).length},this),e},searchGiantBombGames:function(t,a,r,s){var o=this;return e.get(i,{params:{q:t,platform:a,limit:r,offset:s}}).then(function(e){return angular.forEach(e.data.giantbombGame,function(t,a){e.data.giantbombGame[a].thumbImgUrl=o.getThumbUrl(t)}),e.data.giantbombGame})},getGiantBombGame:function(t){var r=this,s=a.defer();return r.gbGamesCache[t]?(s.resolve(r.gbGamesCache[t]),s.promise):e.get(i+"/"+t).then(function(e){return e.data.giantbombGame?(r.gbGamesCache[t]=e.data.giantbombGame,e.data.genre&&(r.gbGamesCache[t].genreModels=e.data.genre),e.data.platform&&(r.gbGamesCache[t].platformModels=e.data.platform),r.gbGamesCache[t]):(s.reject("Game not found!"),s.promise)})},getById:function(e){return t("findByProperty")(this.games,"id",parseInt(e,10))},getThumbUrl:function(e){var t=null;return(e.storedThumbImg||e.hasImg)&&(t=o+(e.gbGameId||e._id)+".jpg"),t},create:function(e,r){var i,o,n=a.defer(),c=!1;return e.platformId&&e.gbGameId&&e.platformName&&e.gameName||(c="Missing required fields."),c||(i=t("findByProperty")(this.games,{platformId:e.platformId,gbGameId:e.gbGameId}),i&&(c="This game is already in your collection.")),c?(r&&s.add({text:c,context:"danger"}),n.reject(c),n.promise):(o=angular.extend({id:this._getNextId(),createdDate:new Date},e),this.games.push(o),r&&s.add({text:'"'+o.gameName+'" has been added to your collection.'}),this._persistChanges(),n.resolve(o),n.promise)},update:function(e,t,r){var i=a.defer();return e?t?(angular.forEach(t,function(t,a){e[a]=t},this),e.updatedDate=new Date,t.completed===!0?e.completedDate=new Date:t.completed===!1&&(e.completedDate=null),r&&s.add({icon:this._getNotificationIcon(t),text:this._getNotificationText(t,1,e.gameName)}),this._persistChanges(),i.resolve(e),i.promise):(i.reject("No properties were provided."),i.promise):(i.reject("The game could not be found."),i.promise)},remove:function(e,t){var r=a.defer(),i=this.games.indexOf(e),o=e.gameName;return-1===i?(r.reject("The game could not be found."),r.promise):(this.games.splice(i,1),t&&s.add({icon:"trash",text:'"'+o+'" has been removed.'}),this._persistChanges(),r.resolve(!0),r.promise)},hasSelection:function(e){var a=angular.extend({selected:!0},e?e:{});return null!==t("findByProperty")(this.games,a)},getSelection:function(e){var a=angular.extend({selected:!0},e?e:{});return t("filter")(this.games,a)},selectGames:function(e){_.each(e,function(e){this.selectGame(e,!0)},this)},selectGame:function(e,t){t||this.deselectAllGames(),e.selected=!0},deselectGames:function(e){_.each(e,function(e){this.deselectGame(e)},this)},deselectGame:function(e){e.selected=!1},toggleGameSelection:function(e){e.selected=!e.selected},deselectAllGames:function(){angular.forEach(this.games,this.deselectGame,this)},updateSelection:function(e,t,a){var r,i;this.hasSelection(t)&&(r=this.getSelection(t),i=r[0].gameName,angular.forEach(r,function(t){this.update(t,e)},this),a&&s.add({icon:this._getNotificationIcon(e),text:this._getNotificationText(e,r.length,i)}))},removeSelection:function(e,t){var a,r;this.hasSelection(e)&&(a=this.getSelection(e),r=a[0].gameName,angular.forEach(a,function(e){this.remove(e)},this),t&&s.add({icon:"trash",text:a.length>1?"The selected games have been removed.":'"'+r+'" has been removed.'}))},getOrderBy:function(){return this.orderBy},updateSorting:function(){this.orderBy=(this.orderDesc?"-":"")+this.orderByProp,r.set("gamesOrderByProp",this.orderByProp),r.set("gamesOrderDesc",this.orderDesc)},updateSortProp:function(e){this.orderByProp=e,this.updateSorting()},toggleSortDir:function(){this.orderDesc=!this.orderDesc,this.updateSorting()},_getNotificationText:function(e,t,a){var r=t>1?"The selected "+t+" games have been updated.":'"'+a+'" has been updated.';return e.completed===!0&&e.wishlisted===!1?r=t>1?"The selected "+t+" games have been marked as completed.":'"'+a+'" has been marked as completed.':e.completed===!1&&e.wishlisted===!1?r=t>1?"The selected "+t+" games have been moved to the backlog.":'"'+a+'" has been moved to the backlog.':e.wishlisted===!1?r=t>1?"The selected "+t+" games have been moved to your library.":'"'+a+'" has been moved to your library.':e.wishlisted===!0&&(r=t>1?"The selected "+t+" games have been moved to your wishlist.":'"'+a+'" has been moved to your wishlist.'),r},_getNotificationIcon:function(e){var t="check-circle";return e.completed===!0&&e.wishlisted===!1?t="check":e.completed===!1&&e.wishlisted===!1?t="inbox":e.wishlisted===!1?t="university":e.wishlisted===!0&&(t="gift"),t},_persistChanges:function(){r.set("games",this.games)},_getNextId:function(){var e=_.reduce(this.games,function(e,t){return e.id>t.id?e.id:t.id},0);return e+1},_fetchGamesFromStorage:function(){var e=r.get("games")||[],t=["createdDate","updatedDate","releaseDate","completedDate"];return e=_.map(e,function(e){return _.each(t,function(t){e[t]&&(e[t]=new Date(e[t]))}),e.selected=!1,e})}};return n.init()}]);
angular.module("backlogr").factory("LocalStorage",["$window",function(e){var t,o={},l="ls-test";try{e.localStorage.setItem(l,l),e.localStorage.removeItem(l),t=!0}catch(r){t=!1}return{set:function(l,r){t?e.localStorage.setItem(l,e.JSON.stringify(r)):o[l]=r},get:function(l){var r;if(t){if(r=e.localStorage.getItem(l),null!==r)try{r=e.JSON.parse(r)}catch(a){r=null}}else r=o[l];return r},remove:function(l){t?e.localStorage.removeItem(l):o[l]&&delete o[l]},removeAll:function(){t?e.localStorage.clear():o={}}}}]);
angular.module("backlogr").factory("Modal",["$document","$animate","$compile","$templateRequest","$controller","$q","$rootScope","$timeout",function(e,n,o,t,r,l,c,i){var s=angular.element(e[0].body),u=function(e,n){var o=l.defer();return e?o.resolve(e):n?t(n,!0).then(function(e){o.resolve(e)},function(e){o.reject(e)}):o.reject("No template or templateUrl has been specified."),o.promise},a=function(e,o){var t=e.children();return t.length>0?n.enter(o,e,t[t.length-1]).then(function(){i(function(){o[0].focus()})}):n.enter(o,e).then(function(){i(function(){o[0].focus()})})};return{_isOpen:!1,_openModal:null,show:function(e){var t=this,f=l.defer();return t.isOpen()?(f.reject("Only one modal can be open at a time."),f.promise):e.controller?(u(e.template,e.templateUrl).then(function(u){var m,p,d,h,v,T=(e.scope||c).$new(),$=l.defer(),x=l.defer(),C={$scope:T,close:function(e,o){var r=o||0;i(function(){$.resolve(e),n.leave(p).then(function(){x.resolve(e),T.$destroy(),T=null,p=null,$=null,t._isOpen=!1})},r)}};e.inputs&&angular.extend(C,e.inputs),d=o(u),p=d(T),C.$element=p,h=T[e.controllerAs],v=r(e.controller,C,!1,e.controllerAs),e.controllerAs&&h&&angular.extend(v,h),e.appendElement?a(e.appendElement,p):a(s,p),m={controller:v,scope:T,element:p,close:$.promise,closed:x.promise},t._isOpen=!0,f.resolve(m)}).then(null,function(e){f.reject(e)}),f.promise):(f.reject("No controller has been specified."),f.promise)},showConfirm:function(e){return this.show({templateUrl:"modals/confirm.html",controller:function(n,o,t,r,l,c){n.confirmTitle=o,n.bodyText=t,n.confirmBtnText=r,n.cancelBtnText=l,n.onConfirmClick=function(){e.onConfirm&&e.onConfirm(),c()},n.onCancelClick=function(){e.onCancel&&e.onCancel(),c()}},inputs:{confirmTitle:e.confirmTitle||"Confirm Action",bodyText:e.bodyText||"Are you sure?",confirmBtnText:e.confirmBtnText||"Yes",cancelBtnText:e.cancelBtnText||"No"}})},isOpen:function(){return this._isOpen}}}]);
angular.module("backlogr").factory("Platforms",["$http","$q","$filter",function(e,t,r){var a="https://libjitsu.herokuapp.com/api/platforms";return{platforms:!1,groups:[{id:"gen-8",label:"Current Generation"},{id:"gen-7",label:"Last Generation (2005 - 2012)"},{id:"gen-6",label:"6th Generation (1998 - 2005)"},{id:"gen-5",label:"5th Generation (1993 - 1999)"},{id:"gen-4",label:"4th Generation (1987 - 1995)"},{id:"gen-3",label:"3rd Generation (1983 - 1987)"},{id:"gen-2",label:"2nd Generation (1976 - 1983)"},{id:"gen-1",label:"1st Generation (1972 - 1976)"},{id:"retro-pc",label:"Retro Personal Computers"},{id:"other",label:"Other"}],all:function(){var r=this;return r.platforms?t.defer().resolve(r.platforms):e.get(a).then(function(e){return angular.forEach(e.data.platform,function(t,r){t.group||(e.data.platform[r].group="other")}),r.platforms=e.data.platform,r.platforms})},get:function(e){return r("findByProperty")(this.platforms,"_id",parseInt(e,10))}}}]);
angular.module("backlogr").factory("Window",["$window",function(i){var n={lgDeviceMinWidth:992,windowWidth:0,debounceDelay:300,init:function(){this.winElem=angular.element(i),this.winElem.bind("resize",_.debounce(angular.bind(this,this.onWindowResize),this.debounceDelay)),this.onWindowResize()},onWindowResize:function(){this.windowWidth=i.innerWidth},getWindowWidth:function(){return this.windowWidth},isLargeDevice:function(){return this.windowWidth>=this.lgDeviceMinWidth},isSmallDevice:function(){return this.windowWidth<this.lgDeviceMinWidth}};return n.init(),n}]);